{% extends 'base.html' %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}{% translate "Book Vehicle" %}{% endblock %}

{% block content %}
{# 1. Load Flatpickr CSS from your static files #}
<link rel="stylesheet" href="{% static 'css/flatpickr.min.css' %}">

<div class="container my-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h1 class="card-title text-center mb-4">{% translate "Book" %} {{ vehicle.model }} ({{ vehicle.license_plate }})</h1>

                    {% if vehicle.available_after %}
                        <div class="alert alert-info" role="alert">
                            <p class="mb-0">
                                {% translate "This vehicle is available for booking on or after" %} <strong>{{ vehicle.available_after|date:"Y-m-d" }}</strong>.
                            </p>
                        </div>
                    {% endif %}

                    <div id="date-validation-error" class="alert alert-danger" style="display: none;"></div>

                    {% crispy form %}
                </div>
            </div>
        </div>
    </div>
</div>

{# 2. Safely pass the date ranges from the view to the template #}
{{ painted_ranges_json|json_script:"painted-ranges-data" }}
{{ validation_ranges_json|json_script:"validation-ranges-data" }}

{# --- ADDED: This div is required by the JavaScript to get data --- #}
<div id="calendar-data-container"
     data-available-after="{{ vehicle.available_after|date:'d-m-Y' }}"
     data-error-msg-end-date="{% translate 'The end date must be on or after the start date.' %}"
></div>

{# 3. Load the JS files at the end of the body #}
<script src="{% static 'js/flatpickr.min.js' %}"></script>
<script src="{% static 'js/booking_calendar.js' %}"></script>
{% endblock %}
